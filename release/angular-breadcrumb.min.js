/*! angular-breadcrumb - v0.4.1-dev-2015-09-08
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2015 Nicolas Cuillery; Licensed MIT */
!function(a,b,c){"use strict";function d(a,c){return b.equals(a.length,c.length)?a>c:a.length>c.length}function e(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function f(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null,includeAbstract:!1};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams","$rootScope",function(b,f,g){var h=g;g.$on("$viewContentLoaded",function(a){!a.targetScope.ncyBreadcrumbIgnore&&d(a.targetScope.$id,h.$id)&&(h=a.targetScope)});var i=function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1],c="object"==typeof b;return c?b.name:b},j=function(c,d){for(var g,i,j=e(d),k=!1,l=!1,m=0,n=c.length;n>m;m+=1)if(c[m].name===j.state)return;g=b.get(j.state),g.ncyBreadcrumb&&(g.ncyBreadcrumb.force&&(k=!0),g.ncyBreadcrumb.skip&&(l=!0)),g["abstract"]&&!a.includeAbstract&&!k||l||(j.paramExpr&&(i=h.$eval(j.paramExpr)),g.ncyBreadcrumbLink=b.href(j.state,i||f||{}),c.unshift(g))},k=function(a){var c=e(a),d=b.get(c.state);if(d.ncyBreadcrumb&&d.ncyBreadcrumb.parent){var f="function"==typeof d.ncyBreadcrumb.parent,g=f?d.ncyBreadcrumb.parent(h):d.ncyBreadcrumb.parent;if(g)return g}return i(d)};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getStatesChain:function(c){for(var d=[],e=b.$current.self.name;e;e=k(e))if(j(d,e),c&&d.length)return d;return a.prefixStateName&&j(d,a.prefixStateName),d},getLastStep:function(){var a=this.getStatesChain(!0);return a.length?a[0]:c},$getLastViewScope:function(){return h}}}]}function g(a,c,d,e){var f={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:c.getTemplate(f),templateUrl:c.getTemplateUrl(),link:{post:function(f){var g=[],h=function(){l(g),g=[];var d=c.$getLastViewScope();f.steps=c.getStatesChain(),b.forEach(f.steps,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===c||"[object Array]"===c)b.ncyBreadcrumbLabel=e.invoke(b.ncyBreadcrumb.label);else{var f=a(b.ncyBreadcrumb.label);b.ncyBreadcrumbLabel=f(d),k(g,f,d,b)}}else b.ncyBreadcrumbLabel=b.name})};d.$on("$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||h()}),h()}}}}function h(a,b,c,d){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbLabel}}",compile:function(e,f){var g=e.attr(f.$attr.ncyBreadcrumbLast);return g&&e.html(g),{post:function(e){var f=[],g=function(){l(f),f=[];var c=b.$getLastViewScope(),g=b.getLastStep();if(g)if(e.ncyBreadcrumbLink=g.ncyBreadcrumbLink,g.ncyBreadcrumb&&g.ncyBreadcrumb.label){var h=Object.prototype.toString.call(g.ncyBreadcrumb.label);if("[object Function]"===h||"[object Array]"===h)g.ncyBreadcrumbLabel=d.invoke(g.ncyBreadcrumb.label);else{var i=a(g.ncyBreadcrumb.label);g.ncyBreadcrumbLabel=i(c),k(f,i,c,g)}}else e.ncyBreadcrumbLabel=g.name};c.$on("$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||g()}),g()}}}}}function i(a,c,d,e){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(f,g){var h=f.attr(g.$attr.ncyBreadcrumbText);h&&f.html(h);var i=f.attr(g.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(f){var g=[],h=function(a,c,d){b.forEach(j(c),function(b){var c=d.$watch(b,function(a,b){a!==b&&k()});a.push(c)})},k=function(){l(g),g=[];var d=c.$getLastViewScope(),j=c.getStatesChain(),k=[];b.forEach(j,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===c||"[object Array]"===c)b.ncyBreadcrumbLabel=e.invoke(b.ncyBreadcrumb.label);else{var f=a(b.ncyBreadcrumb.label);b.ncyBreadcrumbLabel=f(d),h(g,f,d,b)}}else k.push(b.name)}),f.ncyBreadcrumbChain=k.join(i)};d.$on("$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||k()}),k()}}}}}var j=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},k=function(a,c,d,e){b.forEach(j(c),function(b){var f=d.$watch(b,function(){e.ncyBreadcrumbLabel=c(d)});a.push(f)})},l=function(a){b.forEach(a,function(a){a()})};g.$inject=["$interpolate","$breadcrumb","$rootScope","$injector"],h.$inject=["$interpolate","$breadcrumb","$rootScope","$injector"],i.$inject=["$interpolate","$breadcrumb","$rootScope","$injector"],b.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",f).directive("ncyBreadcrumb",g).directive("ncyBreadcrumbLast",h).directive("ncyBreadcrumbText",i)}(window,window.angular);
