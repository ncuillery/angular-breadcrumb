/*! angular-breadcrumb - v0.4.1-dev-2016-04-29
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2016 Nicolas Cuillery; Licensed MIT */
!function(a,b,c){"use strict";function d(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function e(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}function f(a,b,d,e){var f=k[a];f!==c&&f(),f=b.$on(d,e),k[a]=f}function g(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams","$rootScope","$injector","$q",function(f,g,h,i,j){function k(){var a=f.$current,b=e(a.views);if(b){if(a.ncyBreadcrumb&&a.ncyBreadcrumb.mainView)return a.locals[a.ncyBreadcrumb.mainView];if(1===b){for(var c in a.views)if(a.views.hasOwnProperty(c))return a.locals[c]}else if(a.views["@"])return a.locals["@"];throw new Error("Multiple views found and mainView was not defined")}}function l(){var a=k();return a?a.$scope||h:h}function m(a,b,c){return q(b).then(function(b){return!b||c&&a.length?a:(p(a,b),m(a,b))})}function n(b){!a.prefixStateName||b.length&&a.prefixStateName===b[0].name||p(b,a.prefixStateName)}var o=function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1],c="object"==typeof b;return c?b.name:b},p=function(c,e){var h,i,j=d(e),k=!1,m=!1;h=b.copy(f.get(j.state)),h.ncyBreadcrumb&&(h.ncyBreadcrumb.force&&(k=!0),h.ncyBreadcrumb.skip&&(m=!0)),h["abstract"]&&!a.includeAbstract&&!k||m||(j.paramExpr&&(i=l().$eval(j.paramExpr)),h.ncyBreadcrumbLink=f.href(j.state,i||g||{}),h.ncyBreadcrumbStateRef=e,c.unshift(h))},q=function(a){var b=d(a),c=f.get(b.state);if(c.ncyBreadcrumb&&c.ncyBreadcrumb.parent){var e,g,h=Object.prototype.toString.call(c.ncyBreadcrumb.parent);if("[object Function]"===h||"[object Array]"===h?(g=k(),e=i.invoke(c.ncyBreadcrumb.parent,null,g)):e=c.ncyBreadcrumb.parent,e)return j.when(e)}return j.when(o(c))};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getTemplateLast:function(b){return a.templateLastUrl?null:b[a.templateLast]?b[a.templateLast]:a.templateLast},getTemplateLastUrl:function(){return a.templateLastUrl},getStatesChain:function(a){var b=[];if(!f.$current.self.name)return n(b),j.when(b);if(p(b,f.$current.self.name),a&&b.length)return j.when(b);var c=m(b,f.$current.self.name,a);return j.when(c).then(function(){return n(b),b})},getLastStep:function(){return this.getStatesChain(!0).then(function(a){return a.length?a[0]:c})},$getLastViewScope:l,$getLastViewLocals:k}}]}function h(a,c,d,e,g){var h={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:c.getTemplate(h),templateUrl:c.getTemplateUrl(),link:{post:function(h){var i=[],j=function(){n(i),i=[];var d=c.$getLastViewScope(),f=c.$getLastViewLocals();c.getStatesChain().then(function(c){h.steps=c,b.forEach(h.steps,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===c||"[object Array]"===c)g.when(e.invoke(b.ncyBreadcrumb.label,null,f)).then(function(a){b.ncyBreadcrumbLabel=a});else{var h=a(b.ncyBreadcrumb.label);b.ncyBreadcrumbLabel=h(d),m(i,h,d,b)}}else b.ncyBreadcrumbLabel=b.name})})};f("BreadcrumbDirective.$viewContentLoaded",d,"$viewContentLoaded",function(){j()}),j()}}}}function i(a,b,c,d,e){var g={"default":"{{ncyBreadcrumbLabel}}"};return{restrict:"A",scope:{},template:b.getTemplateLast(g),templateUrl:b.getTemplateLastUrl(),compile:function(g,h){var i=g.attr(h.$attr.ncyBreadcrumbLast);return i&&g.html(i),{post:function(g){var h=[],i=function(){n(h),h=[];var c=b.$getLastViewScope(),f=b.$getLastViewLocals();b.getLastStep().then(function(b){if(b)if(g.ncyBreadcrumbLink=b.ncyBreadcrumbLink,b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var i=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===i||"[object Array]"===i)e.when(d.invoke(b.ncyBreadcrumb.label,null,f)).then(function(a){g.ncyBreadcrumbLabel=a});else{var j=a(b.ncyBreadcrumb.label);g.ncyBreadcrumbLabel=j(c),m(h,j,c,g)}}else g.ncyBreadcrumbLabel=b.name})};f("BreadcrumbLastDirective.$viewContentLoaded",c,"$viewContentLoaded",function(){i()}),i()}}}}}function j(a,c,d,e,g){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(h,i){var j=h.attr(i.$attr.ncyBreadcrumbText);j&&h.html(j);var k=h.attr(i.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(h){var i=[],j=function(a,c,d){b.forEach(l(c),function(b){var c=d.$watch(b,function(a,b){a!==b&&m()});a.push(c)})},m=function(){n(i),i=[];var d=c.$getLastViewScope(),f=c.$getLastViewLocals();c.getStatesChain().then(function(c){var l=[];b.forEach(c,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=Object.prototype.toString.call(b.ncyBreadcrumb.label);if("[object Function]"===c||"[object Array]"===c)l.push(g.when(e.invoke(b.ncyBreadcrumb.label,null,f)));else{var h=a(b.ncyBreadcrumb.label);l.push(g.when(h(d))),j(i,h,d)}}else l.push(g.when(b.name))}),h.ncyBreadcrumbChain=[],g.all(l).then(function(a){h.ncyBreadcrumbChain=a.join(k)})})};f("BreadcrumbTextDirective.$viewContentLoaded",d,"$viewContentLoaded",function(){m()}),m()}}}}}var k={},l=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},m=function(a,c,d,e){b.forEach(l(c),function(b){var f=d.$watch(b,function(){e.ncyBreadcrumbLabel=c(d)});a.push(f)})},n=function(a){b.forEach(a,function(a){a()})};h.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$q"],i.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$q"],j.$inject=["$interpolate","$breadcrumb","$rootScope","$injector","$q"],b.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",g).directive("ncyBreadcrumb",h).directive("ncyBreadcrumbLast",i).directive("ncyBreadcrumbText",j)}(window,window.angular);